<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <script src="//cdnjs.cloudflare.com/ajax/libs/p5.js/0.5.7/p5.js"></script>
    <script type="text/javascript">
      let img, img_h, img_s, img_v;

      function preload() {
        img = loadImage(
          "https://raw.githubusercontent.com/scikit-image/scikit-image/master/skimage/data/astronaut.png"
        );
      }

      function setup() {
        createCanvas(512, 512);
        img.resize(256, 256);

        img_h = createImage(256, 256);
        img_s = createImage(256, 256);
        img_v = createImage(256, 256);

        img.loadPixels();
        img_h.loadPixels();
        img_s.loadPixels();
        img_v.loadPixels();

        for (let i = 0; i < img.pixels.length; i += 4) {
          let r = img.pixels[i] / 255;
          let g = img.pixels[i + 1] / 255;
          let b = img.pixels[i + 2] / 255;

          // cmax i cmin
          let cmax = Math.max(r, g, b);
          let cmin = Math.min(r, g, b);
          let c = cmax - cmin;

          // obliczamy V
          let v = cmax;

          // obliczamy L (dla HSL)
          let l = (cmax + cmin) / 2;

          // obliczamy saturację (dla HSV)
          let s_hsv = cmax === 0 ? 0 : c / cmax;

          // obliczamy Hue
          let h = 0;
          if (c !== 0) {
            if (v === r) {
              h = ((g - b) / c) % 6;
            } else if (v === g) {
              h = ((b - r) / c) + 2;
            } else {
              h = ((r - g) / c) + 4;
            }
            h /= 6;
            if (h < 0) h += 1;
          }

          // współrzędne x i y
          let x = (i / 4) % 256;
          let y = Math.floor((i / 4) / 256);

          // ustawiamy wartość odcienia na img_h
          img_h.set(x, y, color(255 * h));
          img_s.set(x, y, color(255 * s_hsv));
          img_v.set(x, y, color(255 * v));
        }

        img_h.updatePixels();
        img_s.updatePixels();
        img_v.updatePixels();

        // wyświetlenie obrazów
        image(img_h, 0, 0); // obraz odcienia
        image(img_s, 256, 0); // Obraz saturacji
        image(img_v, 0, 256); // Obraz wartości (jasności)
        image(img, 256, 256); // Oryginalny obraz
      }
    </script>
  </head>
  <body></body>
</html>
